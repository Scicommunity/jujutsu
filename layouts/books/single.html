{{ define "main" }}
<main class="book-page">
    <article class="book">

        <header class="book__header">
            <div class="book__cover">
                {{ with .Resources.GetMatch "cover.*" }}
                <img src="{{ .RelPermalink }}" alt="Обложка: {{ $.Title }}">
                {{ end }}
            </div>

            <div class="book__meta">
                <h1 class="book__title">
                    {{ .Title }}
                </h1>

                {{ with .Params.subTitle }}
                <p class="book__subtitle">
                    {{ . }}
                </p>
                {{ end }}

                {{ with .Params.creators }}
                <p class="book__authors-line">
                    Автор{{ if gt (len .) 1 }}ы{{ end }}:
                    {{ range $i, $c := . }}
                    {{ if $i }}, {{ end }}
                    {{ with $c.given }}{{ . }} {{ end }}{{ $c.family }}
                    {{ end }}
                </p>
                {{ end }}

                {{/* Рейтинг 0–10, целый */}}
                {{ with .Params.rating }}
                {{ $rating := int . }}
                {{ $max := 10 }}
                <p class="book__rating">
                    <strong>Рейтинг:</strong>
                    {{ range seq 1 $max }}
                    {{ if le . $rating }}
                    ★
                    {{ else }}
                    ☆
                    {{ end }}
                    {{ end }}
                    <span class="book__rating-value">({{ $rating }}/10)</span>
                </p>
                {{ end }}

                <div class="book__facts">
                    {{ with .Params.year }}
                    <p><strong>Год издания:</strong> {{ . }}</p>
                    {{ end }}

                    {{ with .Params.publisher }}
                    <p><strong>Издательство:</strong> {{ . }}</p>
                    {{ end }}

                    {{ with .Params.place }}
                    <p><strong>Город:</strong> {{ . }}</p>
                    {{ end }}

                    {{ with .Params.ISBN }}
                    <p><strong>ISBN:</strong> {{ . }}</p>
                    {{ end }}

                    {{ with .Params.pages }}
                    <p><strong>Страницы:</strong> {{ . }}</p>
                    {{ end }}

                    {{ with .Params.language }}
                    <p><strong>Язык:</strong> {{ . }}</p>
                    {{ end }}

                    {{ with .Params.series }}
                    <p>
                        <strong>Серия / подборка:</strong>
                        {{ . }}
                        {{ with $.Params.series_number }} (№ {{ . }}){{ end }}
                    </p>
                    {{ end }}
                </div>

                {{ with .Params.tags }}
                <div class="book__tags">
                    <strong>Теги:</strong>
                    {{ range $i, $tag := . }}
                    {{ if $i }}, {{ end }}{{ $tag }}
                    {{ end }}
                </div>
                {{ end }}

                {{ with .Params.url }}
                <p class="book__link">
                    <strong>Ссылка:</strong>
                    <a href="{{ . }}" target="_blank" rel="noopener noreferrer">
                        открыть ресурс
                    </a>
                </p>
                {{ end }}

                {{ with .Params.zotero }}
                <div class="book__zotero">
                    <strong>Zotero:</strong>
                    {{ with .key }} ключ {{ . }}{{ end }}
                    {{ with .collection }}, коллекция {{ . }}{{ end }}
                    {{ with .zotero_item_type }}, тип {{ . }}{{ end }}
                </div>
                {{ end }}

                {{ with .Params.rights }}
                <p class="book__rights">
                    <strong>Права:</strong> {{ . }}</p>
                {{ end }}
            </div>
        </header>

        <section class="book__abstract">
            <h2>Краткий пересказ</h2>
            {{ with .Params.abstractNote }}
            <p>{{ . }}</p>
            {{ else }}
            {{ with .Summary }}
            <p>{{ . }}</p>
            {{ end }}
            {{ end }}
        </section>

        <section class="book__content">
            <h2>Подробное описание и материалы</h2>
            <div class="book__body">
                {{ .Content }}
            </div>
        </section>

        {{ with .Params.attachments }}
        <section class="book__attachments">
            <h2>Дополнительные материалы</h2>
            <ul>
                {{ range . }}
                <li>
                    {{ .title }}:
                    {{ with $.Resources.GetMatch .file }}
                    <a href="{{ .RelPermalink }}">{{ .Name }}</a>
                    {{ else }}
                    {{ .file }}
                    {{ end }}
                </li>
                {{ end }}
            </ul>
        </section>
        {{ end }}

    </article>
</main>
{{ end }}
