{{ define "main" }}
<main class="books-layout">
    <section class="books-catalog">
        <header class="books-catalog__header">
            <h1>{{ .Title }}</h1>
            {{ with .Content }}
            <div class="books-catalog__intro">
                {{ . }}
            </div>
            {{ end }}
        </header>

        {{/* все страницы секции books по всему сайту, отсортированные по году (year) убыванию */}}
        {{ $pages := where .Site.RegularPages "Section" "books" }}
        {{ $pages = sort $pages ".Params.year" "desc" }}

        {{ if not $pages }}
        <p>В этой секции пока нет книг.</p>
        {{ else }}
        <div class="books-catalog__grid">
            {{ range $pages }}
            <article class="books-card">
                <a href="{{ .RelPermalink }}" class="books-card__link">

                    {{ with .Resources.GetMatch "cover.*" }}
                    <div class="books-card__cover">
                        <img src="{{ .RelPermalink }}" alt="Обложка: {{ $.Title }}">
                    </div>
                    {{ end }}

                    <div class="books-card__body">
                        <h2 class="books-card__title">{{ .Title }}</h2>

                        {{ with .Params.subTitle }}
                        <p class="books-card__subtitle">
                            {{ . }}
                        </p>
                        {{ end }}

                        {{ with .Params.creators }}
                        <div class="books-card__authors">
                            {{ range $i, $c := . }}
                            {{ if $i }}, {{ end }}
                            {{ with $c.given }}{{ . }} {{ end }}{{ $c.family }}
                            {{ end }}
                        </div>
                        {{ end }}

                        {{ with .Params.series }}
                        <div class="books-card__series">
                            {{ . }}
                        </div>
                        {{ end }}

                        <div class="books-card__meta">
                            {{ with .Params.year }}
                            <span class="books-card__year">
                  {{ . }}
                </span>
                            {{ end }}

                            {{ with .Params.tags }}
                            <span class="books-card__tags">
                  {{ range $index, $tag := . }}
                    {{ if $index }}, {{ end }}{{ $tag }}
                  {{ end }}
                </span>
                            {{ end }}
                        </div>

                        {{ with .Params.abstractNote }}
                        <p class="books-card__abstract">
                            {{ . }}
                        </p>
                        {{ else }}
                        {{ with .Summary }}
                        <p class="books-card__abstract">
                            {{ . }}
                        </p>
                        {{ end }}
                        {{ end }}
                    </div>
                </a>
            </article>
            {{ end }}
        </div>
        {{ end }}
    </section>
</main>
{{ end }}
